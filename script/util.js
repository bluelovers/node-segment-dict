"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const table_1 = require("cjk-conv/lib/zh/table");
const list_1 = require("cjk-conv/lib/zh/table/list");
const fast_glob_1 = require("fast-glob");
const BluebirdPromise = require("bluebird");
const line_1 = require("../lib/loader/line");
const index_1 = require("../lib/loader/segment/index");
const naturalCompare = require("string-natural-compare");
const array_hyper_unique_1 = require("array-hyper-unique");
const StrUtil = require("str-util");
exports.DEFAULT_IGNORE = [
    //'char*',
    '**/skip',
    '**/jieba',
    '**/lazy',
    '**/synonym',
    '**/names',
];
function globDict(cwd, pattern, ignore = exports.DEFAULT_IGNORE) {
    return BluebirdPromise
        .resolve(fast_glob_1.default(pattern, {
        cwd,
        absolute: true,
        ignore,
        markDirectories: true,
    }));
}
exports.globDict = globDict;
function loadDictFile(file, fn, options) {
    options = options || {};
    const parseFn = options.parseFn = options.parseFn || index_1.parseLine;
    return line_1.default(file)
        .then(function (b) {
        return b.reduce(function (a, line, index, arr) {
            let bool;
            let data = parseFn(line);
            let cur = {
                data,
                line,
                index,
            };
            if (fn) {
                // @ts-ignore
                bool = fn(a, cur);
            }
            else {
                bool = true;
            }
            if (bool) {
                a.push(cur);
            }
            return a;
        }, []);
    });
}
exports.loadDictFile = loadDictFile;
var EnumLineType;
(function (EnumLineType) {
    EnumLineType[EnumLineType["BASE"] = 0] = "BASE";
    EnumLineType[EnumLineType["COMMENT"] = 1] = "COMMENT";
    EnumLineType[EnumLineType["COMMENT_TAG"] = 2] = "COMMENT_TAG";
})(EnumLineType = exports.EnumLineType || (exports.EnumLineType = {}));
function chkLineType(line) {
    let ret = EnumLineType.BASE;
    if (line.indexOf('//') == 0) {
        ret = EnumLineType.COMMENT;
        if (/ @todo/i.test(line)) {
            ret = EnumLineType.COMMENT_TAG;
        }
    }
    return ret;
}
exports.chkLineType = chkLineType;
function baseSortList(ls, bool) {
    return ls.sort(function (a, b) {
        // @ts-ignore
        return naturalCompare.caseInsensitive(a.cjk_id, b.cjk_id)
            // @ts-ignore
            || naturalCompare.caseInsensitive(a.data[1], b.data[1])
            // @ts-ignore
            || naturalCompare.caseInsensitive(a.data[0], b.data[0])
            // @ts-ignore
            || naturalCompare.caseInsensitive(a.data[2], b.data[2]);
    });
}
exports.baseSortList = baseSortList;
function getCjkName(w, USE_CJK_MODE) {
    let cjk_id = w;
    if (1) {
        cjk_id = list_1.slugify(w, true);
    }
    else if (USE_CJK_MODE > 1) {
        let cjk_list = list_1.textList(w);
        cjk_list.sort();
        cjk_id = cjk_list[0];
    }
    else if (USE_CJK_MODE) {
        let cjk_list = table_1.default.auto(w);
        cjk_list.sort();
        cjk_id = cjk_list[0];
    }
    return StrUtil.toHalfWidth(cjk_id);
}
exports.getCjkName = getCjkName;
let _zhDictCompareTable = ((a, b) => {
    return array_hyper_unique_1.array_unique(a.map((value, index, array) => {
        return array_hyper_unique_1.array_unique(value.reduce(function (c, d, currentIndex) {
            c.push(d);
            c.push(b[index][currentIndex]);
            return c;
        }, []));
    }));
})([
    ['一', '二', '两', '三', '四', '五', '六', '七', '八', '九', '十', '十', '零', '幾', '個', '百', '千', '萬', '億'],
    ['上', '下', '左', '右'],
    ['東', '南', '西', '北'],
    ['大', '小'],
    ['高', '低'],
    ['長', '短'],
    ['內', '外'],
    ['男', '女'],
    ['前', '後'],
    ['只', '支', '隻'],
    ['他', '她', '它', '我', '你', '吾', '汝'],
    ['快', '慢'],
    ['春', '夏', '秋', '冬'],
    ['什', '甚'],
    ['侭', '儘', '尽', '盡'],
    ['的', '得'],
    ['胡', '糊', '鬍'],
    ['壹', '貳', '參', '肆', '伍', '陸', '柒', '捌', '玖', '拾', '什'],
    ['儅', '噹', '当', '當'],
    ['炮', '砲', '炰', '泡'],
    ['仲'],
    ['原'],
], [
    ['一', '二', '两', '三', '四', '五', '六', '七', '八', '九', '十', '十', '零', '几', '个', '百', '千', '万', '亿'],
    ['上', '下', '左', '右'],
    ['东', '南', '西', '北'],
    ['大', '小'],
    ['高', '低'],
    ['长', '短'],
    ['内', '外'],
    ['男', '女'],
    ['前', '后'],
    ['只', '支', '隻'],
    ['他', '她', '它', '我', '你', '吾', '汝'],
    ['快', '慢'],
    ['春', '夏', '秋', '冬'],
    ['什', '甚'],
    ['侭', '儘', '尽', '盡'],
    ['的', '得'],
    ['胡', '糊', '鬍'],
    ['壹', '贰', '参', '肆', '伍', '陆', '柒', '捌', '玖', '拾', '什'],
    ['儅', '噹', '当', '當'],
    ['炮', '砲', '炰', '泡'],
    ['中'],
    ['元'],
]);
let _zhDictCompareTable_chars = array_hyper_unique_1.array_unique(_zhDictCompareTable.flat());
function zhDictCompare(a, b) {
    let _c = 0;
    let _a0 = a[0];
    let _b0 = b[0];
    let _a;
    let _b;
    let aa = /[\u3400-\u4DBF\u4E00-\u9FFF\u{20000}-\u{2FA1F}]/u.test(a[0]);
    let bb = /[\u3400-\u4DBF\u4E00-\u9FFF\u{20000}-\u{2FA1F}]/u.test(b[0]);
    if (aa && bb) {
        if (a.length != b.length && (a.length == 1 || b.length == 1)) {
            return a.length - b.length;
        }
        _a = _zhDictCompareTable[0].indexOf(a[0]);
        _b = _zhDictCompareTable[0].indexOf(b[0]);
        aa = _a != -1;
        bb = _b != -1;
        if (aa && !bb) {
            return -1;
        }
        else if (!aa && bb) {
            return 1;
        }
    }
    else {
        if (aa && !bb) {
            return 0;
        }
        else if (!aa && bb) {
            return -1;
        }
    }
    if (_a0 != null) {
        let len = a.length;
        for (let i = 0; i < len; i++) {
            if (!a[i] || !b[i] || a[i] == null || b[i] == null) {
                break;
            }
            else if (a[i] !== b[i]) {
                _a0 = a[i];
                _b0 = b[i];
                break;
            }
        }
    }
    if (_zhDictCompareTable_chars.includes(_a0) && _zhDictCompareTable_chars.includes(_b0)) {
        for (let _arr of _zhDictCompareTable) {
            _a = _arr.indexOf(_a0);
            _b = _arr.indexOf(_b0);
            if (_a > -1 && _b > -1) {
                _c = (_a - _b) || 0;
                break;
            }
        }
    }
    return _c || naturalCompare.caseInsensitive(a, b);
}
exports.zhDictCompare = zhDictCompare;
//console.log(['第', '一', 'Ｔ', '网开一面', '三街六市'].sort(zhDictCompare));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBNkM7QUFDN0MscURBQStEO0FBQy9ELHlDQUFpQztBQUNqQyw0Q0FBNkM7QUFDN0MsNkNBQStFO0FBQy9FLHVEQUFxSDtBQUVySCx5REFBMEQ7QUFDMUQsMkRBQWtEO0FBQ2xELG9DQUFxQztBQVN4QixRQUFBLGNBQWMsR0FBRztJQUM3QixVQUFVO0lBQ1YsU0FBUztJQUNULFVBQVU7SUFDVixTQUFTO0lBQ1QsWUFBWTtJQUNaLFVBQVU7Q0FDVixDQUFDO0FBRUYsU0FBZ0IsUUFBUSxDQUFDLEdBQVcsRUFBRSxPQUFrQixFQUFFLE1BQU0sR0FBRyxzQkFBYztJQUVoRixPQUFPLGVBQWU7U0FDcEIsT0FBTyxDQUFDLG1CQUFRLENBQVMsT0FBTyxFQUFFO1FBQ2xDLEdBQUc7UUFDSCxRQUFRLEVBQUUsSUFBSTtRQUNkLE1BQU07UUFDTixlQUFlLEVBQUUsSUFBSTtLQUNyQixDQUFDLENBQUMsQ0FDRjtBQUNILENBQUM7QUFWRCw0QkFVQztBQVNELFNBQWdCLFlBQVksQ0FBdUIsSUFBWSxFQUM5RCxFQUFtQyxFQUNuQyxPQUVDO0lBR0QsT0FBTyxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7SUFDeEIsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxJQUFJLGlCQUFnQixDQUFDO0lBRXRFLE9BQU8sY0FBSSxDQUFDLElBQUksQ0FBQztTQUNmLElBQUksQ0FBQyxVQUFVLENBQUM7UUFFaEIsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRztZQUU1QyxJQUFJLElBQWEsQ0FBQztZQUVsQixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFekIsSUFBSSxHQUFHLEdBQUc7Z0JBQ1QsSUFBSTtn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LEdBQUcsQ0FBQyxDQUFDLEVBQ3RCO2dCQUNDLEVBQUUsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBRXBCLE1BQU07YUFDTjtTQUNEO0tBQ0Q7SUFFRCxPQUFPLEVBQUUsSUFBSSxjQUFjLENBQUMsZUFBZSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNuRCxDQUFDO0FBcEZELHNDQW9GQztBQUVELG1FQUFtRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsaWJUYWJsZSBmcm9tICdjamstY29udi9saWIvemgvdGFibGUnO1xuaW1wb3J0IHsgdGV4dExpc3QsIHNsdWdpZnkgfSBmcm9tICdjamstY29udi9saWIvemgvdGFibGUvbGlzdCc7XG5pbXBvcnQgRmFzdEdsb2IgZnJvbSAnZmFzdC1nbG9iJztcbmltcG9ydCBCbHVlYmlyZFByb21pc2UgPSByZXF1aXJlKCdibHVlYmlyZCcpO1xuaW1wb3J0IGxvYWQsIHsgcGFyc2VMaW5lLCBzdHJpbmdpZnlMaW5lLCBzZXJpYWxpemUgfSBmcm9tICcuLi9saWIvbG9hZGVyL2xpbmUnO1xuaW1wb3J0IHsgSURpY3RSb3csIHBhcnNlTGluZSBhcyBwYXJzZUxpbmVTZWdtZW50LCBzZXJpYWxpemUgYXMgc2VyaWFsaXplU2VnbWVudCB9IGZyb20gJy4uL2xpYi9sb2FkZXIvc2VnbWVudC9pbmRleCc7XG5pbXBvcnQgeyBJQ1VSX1dPUkQgfSBmcm9tICcuLi90ZXN0L3NvcnQnO1xuaW1wb3J0IG5hdHVyYWxDb21wYXJlID0gcmVxdWlyZSgnc3RyaW5nLW5hdHVyYWwtY29tcGFyZScpO1xuaW1wb3J0IHsgYXJyYXlfdW5pcXVlIH0gZnJvbSAnYXJyYXktaHlwZXItdW5pcXVlJztcbmltcG9ydCBTdHJVdGlsID0gcmVxdWlyZSgnc3RyLXV0aWwnKTtcblxuZXhwb3J0IHR5cGUgSUxvYWREaWN0RmlsZVJvdzI8RCBleHRlbmRzIGFueSA9IFtzdHJpbmcsIG51bWJlciwgbnVtYmVyLCAuLi5hbnlbXV0+ID0gSUxvYWREaWN0RmlsZVJvdzxEPiAmIHtcblx0ZmlsZTogc3RyaW5nLFxuXHRjamtfaWQ6IHN0cmluZyxcblxuXHRsaW5lX3R5cGU6IEVudW1MaW5lVHlwZSxcbn1cblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfSUdOT1JFID0gW1xuXHQvLydjaGFyKicsXG5cdCcqKi9za2lwJyxcblx0JyoqL2ppZWJhJyxcblx0JyoqL2xhenknLFxuXHQnKiovc3lub255bScsXG5cdCcqKi9uYW1lcycsXG5dO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2xvYkRpY3QoY3dkOiBzdHJpbmcsIHBhdHRlcm4/OiBzdHJpbmdbXSwgaWdub3JlID0gREVGQVVMVF9JR05PUkUpXG57XG5cdHJldHVybiBCbHVlYmlyZFByb21pc2Vcblx0XHQucmVzb2x2ZShGYXN0R2xvYjxzdHJpbmc+KHBhdHRlcm4sIHtcblx0XHRcdGN3ZCxcblx0XHRcdGFic29sdXRlOiB0cnVlLFxuXHRcdFx0aWdub3JlLFxuXHRcdFx0bWFya0RpcmVjdG9yaWVzOiB0cnVlLFxuXHRcdH0pKVxuXHRcdDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJTG9hZERpY3RGaWxlUm93PEQgPSBbc3RyaW5nLCBudW1iZXIsIG51bWJlciwgLi4uYW55W11dPlxue1xuXHRkYXRhOiBELFxuXHRsaW5lOiBzdHJpbmcsXG5cdGluZGV4OiBudW1iZXIsXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2FkRGljdEZpbGU8VCA9IElMb2FkRGljdEZpbGVSb3c+KGZpbGU6IHN0cmluZyxcblx0Zm4/OiAobGlzdDogVFtdLCBjdXI6IFQpID0+IGJvb2xlYW4sXG5cdG9wdGlvbnM/OiB7XG5cdFx0cGFyc2VGbj86IChsaW5lOiBzdHJpbmcpID0+IGFueSxcblx0fSxcbik6IEJsdWViaXJkUHJvbWlzZTxUW10+XG57XG5cdG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXHRjb25zdCBwYXJzZUZuID0gb3B0aW9ucy5wYXJzZUZuID0gb3B0aW9ucy5wYXJzZUZuIHx8IHBhcnNlTGluZVNlZ21lbnQ7XG5cblx0cmV0dXJuIGxvYWQoZmlsZSlcblx0XHQudGhlbihmdW5jdGlvbiAoYilcblx0XHR7XG5cdFx0XHRyZXR1cm4gYi5yZWR1Y2UoZnVuY3Rpb24gKGEsIGxpbmUsIGluZGV4LCBhcnIpXG5cdFx0XHR7XG5cdFx0XHRcdGxldCBib29sOiBib29sZWFuO1xuXG5cdFx0XHRcdGxldCBkYXRhID0gcGFyc2VGbihsaW5lKTtcblxuXHRcdFx0XHRsZXQgY3VyID0ge1xuXHRcdFx0XHRcdGRhdGEsXG5cdFx0XHRcdFx0bGluZSxcblx0XHRcdFx0XHRpbmRleCxcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRpZiAoZm4pXG5cdFx0XHRcdHtcblx0XHRcdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHRcdFx0Ym9vbCA9IGZuKGEsIGN1cilcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRib29sID0gdHJ1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChib29sKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0YS5wdXNoKGN1cik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gYTtcblx0XHRcdH0sIFtdKTtcblx0XHR9KVxuXHRcdDtcbn1cblxuZXhwb3J0IGVudW0gRW51bUxpbmVUeXBlXG57XG5cdEJBU0UgPSAwLFxuXHRDT01NRU5UID0gMSxcblx0Q09NTUVOVF9UQUcgPSAyLFxufVxuXG5leHBvcnQgZnVuY3Rpb24gY2hrTGluZVR5cGUobGluZTogc3RyaW5nKTogRW51bUxpbmVUeXBlXG57XG5cdGxldCByZXQgPSBFbnVtTGluZVR5cGUuQkFTRTtcblxuXHRpZiAobGluZS5pbmRleE9mKCcvLycpID09IDApXG5cdHtcblx0XHRyZXQgPSBFbnVtTGluZVR5cGUuQ09NTUVOVDtcblxuXHRcdGlmICgvIEB0b2RvL2kudGVzdChsaW5lKSlcblx0XHR7XG5cdFx0XHRyZXQgPSBFbnVtTGluZVR5cGUuQ09NTUVOVF9UQUc7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGJhc2VTb3J0TGlzdDxUID0gSUxvYWREaWN0RmlsZVJvdzI+KGxzOiBUW10sIGJvb2w/OiBib29sZWFuKVxue1xuXHRyZXR1cm4gbHMuc29ydChmdW5jdGlvbiAoYSwgYilcblx0e1xuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHRyZXR1cm4gbmF0dXJhbENvbXBhcmUuY2FzZUluc2Vuc2l0aXZlKGEuY2prX2lkLCBiLmNqa19pZClcblx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdHx8IG5hdHVyYWxDb21wYXJlLmNhc2VJbnNlbnNpdGl2ZShhLmRhdGFbMV0sIGIuZGF0YVsxXSlcblx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdHx8IG5hdHVyYWxDb21wYXJlLmNhc2VJbnNlbnNpdGl2ZShhLmRhdGFbMF0sIGIuZGF0YVswXSlcblx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdHx8IG5hdHVyYWxDb21wYXJlLmNhc2VJbnNlbnNpdGl2ZShhLmRhdGFbMl0sIGIuZGF0YVsyXSlcblx0XHRcdDtcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDamtOYW1lKHc6IHN0cmluZywgVVNFX0NKS19NT0RFOiBudW1iZXIpXG57XG5cdGxldCBjamtfaWQgPSB3O1xuXG5cdGlmICgxKVxuXHR7XG5cdFx0Y2prX2lkID0gc2x1Z2lmeSh3LCB0cnVlKTtcblx0fVxuXHRlbHNlIGlmIChVU0VfQ0pLX01PREUgPiAxKVxuXHR7XG5cdFx0bGV0IGNqa19saXN0ID0gdGV4dExpc3Qodyk7XG5cdFx0Y2prX2xpc3Quc29ydCgpO1xuXHRcdGNqa19pZCA9IGNqa19saXN0WzBdO1xuXHR9XG5cdGVsc2UgaWYgKFVTRV9DSktfTU9ERSlcblx0e1xuXHRcdGxldCBjamtfbGlzdCA9IGxpYlRhYmxlLmF1dG8odyk7XG5cdFx0Y2prX2xpc3Quc29ydCgpO1xuXHRcdGNqa19pZCA9IGNqa19saXN0WzBdO1xuXHR9XG5cblx0cmV0dXJuIFN0clV0aWwudG9IYWxmV2lkdGgoY2prX2lkKTtcbn1cblxubGV0IF96aERpY3RDb21wYXJlVGFibGUgPSAoKGE6IHN0cmluZ1tdW10sIGI6IHN0cmluZ1tdW10pID0+XG57XG5cdHJldHVybiBhcnJheV91bmlxdWUoYS5tYXAoKHZhbHVlLCBpbmRleCwgYXJyYXkpID0+XG5cdHtcblx0XHRyZXR1cm4gYXJyYXlfdW5pcXVlKHZhbHVlLnJlZHVjZShmdW5jdGlvbiAoYywgZCwgY3VycmVudEluZGV4KVxuXHRcdHtcblx0XHRcdGMucHVzaChkKTtcblx0XHRcdGMucHVzaChiW2luZGV4XVtjdXJyZW50SW5kZXhdKTtcblxuXHRcdFx0cmV0dXJuIGM7XG5cdFx0fSwgW10gYXMgc3RyaW5nW10pKVxuXHR9KSk7XG59KShbXG5cdFsn5LiAJywgJ+S6jCcsICfkuKQnLCAn5LiJJywgJ+WbmycsICfkupQnLCAn5YWtJywgJ+S4gycsICflhasnLCAn5LmdJywgJ+WNgScsICfljYEnLCAn6Zu2JywgJ+W5vicsICflgIsnLCAn55m+JywgJ+WNgycsICfokKwnLCAn5YSEJ10sXG5cdFsn5LiKJywgJ+S4iycsICflt6YnLCAn5Y+zJ10sXG5cdFsn5p2xJywgJ+WNlycsICfopb8nLCAn5YyXJ10sXG5cdFsn5aSnJywgJ+WwjyddLFxuXHRbJ+mrmCcsICfkvY4nXSxcblx0WyfplbcnLCAn55+tJ10sXG5cdFsn5YWnJywgJ+WkliddLFxuXHRbJ+eUtycsICflpbMnXSxcblx0WyfliY0nLCAn5b6MJ10sXG5cdFsn5Y+qJywgJ+aUrycsICfpmrsnXSxcblx0Wyfku5YnLCAn5aW5JywgJ+WugycsICfmiJEnLCAn5L2gJywgJ+WQvicsICfmsZ0nXSxcblx0Wyflv6snLCAn5oWiJ10sXG5cdFsn5pilJywgJ+WkjycsICfnp4snLCAn5YasJ10sXG5cdFsn5LuAJywgJ+eUmiddLFxuXHRbJ+S+rScsICflhJgnLCAn5bC9JywgJ+eboSddLFxuXHRbJ+eahCcsICflvpcnXSxcblx0Wyfog6EnLCAn57OKJywgJ+msjSddLFxuXHRbJ+WjuScsICfosrMnLCAn5Y+DJywgJ+iChicsICfkvI0nLCAn6Zm4JywgJ+afkicsICfmjYwnLCAn546WJywgJ+aLvicsICfku4AnXSxcblx0WyAn5YSFJywgJ+WZuScsICflvZMnLCAn55W2JyBdLFxuXHRbICfngq4nLCAn56CyJywgJ+eCsCcsICfms6EnIF0sXG5cdFsgJ+S7sicgXSxcblx0WyAn5Y6fJyBdLFxuXSwgW1xuXHRbJ+S4gCcsICfkuownLCAn5LikJywgJ+S4iScsICflm5snLCAn5LqUJywgJ+WFrScsICfkuIMnLCAn5YWrJywgJ+S5nScsICfljYEnLCAn5Y2BJywgJ+mbticsICflh6AnLCAn5LiqJywgJ+eZvicsICfljYMnLCAn5LiHJywgJ+S6vyddLFxuXHRbJ+S4iicsICfkuIsnLCAn5bemJywgJ+WPsyddLFxuXHRbJ+S4nCcsICfljZcnLCAn6KW/JywgJ+WMlyddLFxuXHRbJ+WkpycsICflsI8nXSxcblx0Wyfpq5gnLCAn5L2OJ10sXG5cdFsn6ZW/JywgJ+efrSddLFxuXHRbJ+WGhScsICflpJYnXSxcblx0WyfnlLcnLCAn5aWzJ10sXG5cdFsn5YmNJywgJ+WQjiddLFxuXHRbJ+WPqicsICfmlK8nLCAn6Zq7J10sXG5cdFsn5LuWJywgJ+WluScsICflroMnLCAn5oiRJywgJ+S9oCcsICflkL4nLCAn5rGdJ10sXG5cdFsn5b+rJywgJ+aFoiddLFxuXHRbJ+aYpScsICflpI8nLCAn56eLJywgJ+WGrCddLFxuXHRbJ+S7gCcsICfnlJonXSxcblx0Wyfkvq0nLCAn5YSYJywgJ+WwvScsICfnm6EnXSxcblx0WyfnmoQnLCAn5b6XJ10sXG5cdFsn6IOhJywgJ+eziicsICfprI0nXSxcblx0Wyflo7knLCAn6LSwJywgJ+WPgicsICfogoYnLCAn5LyNJywgJ+mZhicsICfmn5InLCAn5o2MJywgJ+eOlicsICfmi74nLCAn5LuAJ10sXG5cdFsgJ+WEhScsICflmbknLCAn5b2TJywgJ+eVticgXSxcblx0WyAn54KuJywgJ+egsicsICfngrAnLCAn5rOhJyBdLFxuXHRbICfkuK0nIF0sXG5cdFsgJ+WFgycgXSxcbl0pO1xuXG5sZXQgX3poRGljdENvbXBhcmVUYWJsZV9jaGFycyA9IGFycmF5X3VuaXF1ZShfemhEaWN0Q29tcGFyZVRhYmxlLmZsYXQoKSk7XG5cbmV4cG9ydCBmdW5jdGlvbiB6aERpY3RDb21wYXJlKGE6IHN0cmluZywgYjogc3RyaW5nKTogbnVtYmVyXG57XG5cdGxldCBfYyA9IDA7XG5cblx0bGV0IF9hMCA9IGFbMF07XG5cdGxldCBfYjAgPSBiWzBdO1xuXG5cdGxldCBfYTogbnVtYmVyO1xuXHRsZXQgX2I6IG51bWJlcjtcblxuXHRsZXQgYWEgPSAvW1xcdTM0MDAtXFx1NERCRlxcdTRFMDAtXFx1OUZGRlxcdXsyMDAwMH0tXFx1ezJGQTFGfV0vdS50ZXN0KGFbMF0pO1xuXHRsZXQgYmIgPSAvW1xcdTM0MDAtXFx1NERCRlxcdTRFMDAtXFx1OUZGRlxcdXsyMDAwMH0tXFx1ezJGQTFGfV0vdS50ZXN0KGJbMF0pO1xuXG5cdGlmIChhYSAmJiBiYilcblx0e1xuXHRcdGlmIChhLmxlbmd0aCAhPSBiLmxlbmd0aCAmJiAoYS5sZW5ndGggPT0gMSB8fCBiLmxlbmd0aCA9PSAxKSlcblx0XHR7XG5cdFx0XHRyZXR1cm4gYS5sZW5ndGggLSBiLmxlbmd0aFxuXHRcdH1cblxuXHRcdF9hID0gX3poRGljdENvbXBhcmVUYWJsZVswXS5pbmRleE9mKGFbMF0pO1xuXHRcdF9iID0gX3poRGljdENvbXBhcmVUYWJsZVswXS5pbmRleE9mKGJbMF0pO1xuXG5cdFx0YWEgPSBfYSAhPSAtMTtcblx0XHRiYiA9IF9iICE9IC0xO1xuXG5cdFx0aWYgKGFhICYmICFiYilcblx0XHR7XG5cdFx0XHRyZXR1cm4gLTFcblx0XHR9XG5cdFx0ZWxzZSBpZiAoIWFhICYmIGJiKVxuXHRcdHtcblx0XHRcdHJldHVybiAxXG5cdFx0fVxuXHR9XG5cdGVsc2Vcblx0e1xuXHRcdGlmIChhYSAmJiAhYmIpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIDBcblx0XHR9XG5cdFx0ZWxzZSBpZiAoIWFhICYmIGJiKVxuXHRcdHtcblx0XHRcdHJldHVybiAtMVxuXHRcdH1cblx0fVxuXG5cdGlmIChfYTAgIT0gbnVsbClcblx0e1xuXHRcdGxldCBsZW4gPSBhLmxlbmd0aDtcblxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspXG5cdFx0e1xuXHRcdFx0aWYgKCFhW2ldIHx8ICFiW2ldIHx8IGFbaV0gPT0gbnVsbCB8fCBiW2ldID09IG51bGwpXG5cdFx0XHR7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSBpZiAoYVtpXSAhPT0gYltpXSlcblx0XHRcdHtcblx0XHRcdFx0X2EwID0gYVtpXTtcblx0XHRcdFx0X2IwID0gYltpXTtcblxuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpZiAoX3poRGljdENvbXBhcmVUYWJsZV9jaGFycy5pbmNsdWRlcyhfYTApICYmIF96aERpY3RDb21wYXJlVGFibGVfY2hhcnMuaW5jbHVkZXMoX2IwKSlcblx0e1xuXHRcdGZvciAobGV0IF9hcnIgb2YgX3poRGljdENvbXBhcmVUYWJsZSlcblx0XHR7XG5cdFx0XHRfYSA9IF9hcnIuaW5kZXhPZihfYTApO1xuXHRcdFx0X2IgPSBfYXJyLmluZGV4T2YoX2IwKTtcblxuXHRcdFx0aWYgKF9hID4gLTEgJiYgX2IgPiAtMSlcblx0XHRcdHtcblx0XHRcdFx0X2MgPSAoX2EgLSBfYikgfHwgMDtcblxuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gX2MgfHwgbmF0dXJhbENvbXBhcmUuY2FzZUluc2Vuc2l0aXZlKGEsIGIpO1xufVxuXG4vL2NvbnNvbGUubG9nKFsn56ysJywgJ+S4gCcsICfvvLQnLCAn572R5byA5LiA6Z2iJywgJ+S4ieihl+WFreW4giddLnNvcnQoemhEaWN0Q29tcGFyZSkpO1xuIl19