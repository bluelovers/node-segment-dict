"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const table_1 = require("cjk-conv/lib/zh/table");
const list_1 = require("cjk-conv/lib/zh/table/list");
const fast_glob_1 = require("fast-glob");
const BluebirdPromise = require("bluebird");
const line_1 = require("../lib/loader/line");
const index_1 = require("../lib/loader/segment/index");
const naturalCompare = require("string-natural-compare");
const array_hyper_unique_1 = require("array-hyper-unique");
const StrUtil = require("str-util");
exports.DEFAULT_IGNORE = [
    //'char*',
    '**/skip',
    '**/jieba',
    '**/lazy',
    '**/synonym',
    '**/names',
];
function globDict(cwd, pattern, ignore = exports.DEFAULT_IGNORE) {
    return BluebirdPromise
        .resolve(fast_glob_1.default(pattern, {
        cwd,
        absolute: true,
        ignore,
        markDirectories: true,
    }));
}
exports.globDict = globDict;
function loadDictFile(file, fn, options) {
    options = options || {};
    const parseFn = options.parseFn = options.parseFn || index_1.parseLine;
    return line_1.default(file)
        .then(function (b) {
        return b.reduce(function (a, line, index, arr) {
            let bool;
            let data = parseFn(line);
            let cur = {
                data,
                line,
                index,
            };
            if (fn) {
                // @ts-ignore
                bool = fn(a, cur);
            }
            else {
                bool = true;
            }
            if (bool) {
                a.push(cur);
            }
            return a;
        }, []);
    });
}
exports.loadDictFile = loadDictFile;
var EnumLineType;
(function (EnumLineType) {
    EnumLineType[EnumLineType["BASE"] = 0] = "BASE";
    EnumLineType[EnumLineType["COMMENT"] = 1] = "COMMENT";
    EnumLineType[EnumLineType["COMMENT_TAG"] = 2] = "COMMENT_TAG";
})(EnumLineType = exports.EnumLineType || (exports.EnumLineType = {}));
function chkLineType(line) {
    let ret = EnumLineType.BASE;
    if (line.indexOf('//') == 0) {
        ret = EnumLineType.COMMENT;
        if (/ @todo/i.test(line)) {
            ret = EnumLineType.COMMENT_TAG;
        }
    }
    return ret;
}
exports.chkLineType = chkLineType;
function baseSortList(ls, bool) {
    return ls.sort(function (a, b) {
        // @ts-ignore
        return naturalCompare.caseInsensitive(a.cjk_id, b.cjk_id)
            // @ts-ignore
            || naturalCompare.caseInsensitive(a.data[1], b.data[1])
            // @ts-ignore
            || naturalCompare.caseInsensitive(a.data[0], b.data[0])
            // @ts-ignore
            || naturalCompare.caseInsensitive(a.data[2], b.data[2]);
    });
}
exports.baseSortList = baseSortList;
function getCjkName(w, USE_CJK_MODE) {
    let cjk_id = w;
    if (USE_CJK_MODE > 1) {
        let cjk_list = list_1.textList(w);
        cjk_list.sort();
        cjk_id = cjk_list[0];
    }
    else if (USE_CJK_MODE) {
        let cjk_list = table_1.default.auto(w);
        cjk_list.sort();
        cjk_id = cjk_list[0];
    }
    return StrUtil.toHalfWidth(cjk_id);
}
exports.getCjkName = getCjkName;
let _zhDictCompareTable = ((a, b) => {
    return array_hyper_unique_1.array_unique(a.map((value, index, array) => {
        return array_hyper_unique_1.array_unique(value.reduce(function (c, d, currentIndex) {
            c.push(d);
            c.push(b[index][currentIndex]);
            return c;
        }, []));
    }));
})([
    ['一', '二', '两', '三', '四', '五', '六', '七', '八', '九', '十', '十', '零', '幾', '個', '百', '千', '萬', '億'],
    ['上', '下', '左', '右'],
    ['東', '南', '西', '北'],
    ['大', '小'],
    ['高', '低'],
    ['長', '短'],
    ['內', '外'],
    ['男', '女'],
    ['前', '後'],
    ['只', '支', '隻'],
    ['他', '她', '它', '我', '你', '吾', '汝'],
    ['快', '慢'],
    ['春', '夏', '秋', '冬'],
], [
    ['一', '二', '两', '三', '四', '五', '六', '七', '八', '九', '十', '十', '零', '几', '个', '百', '千', '万', '亿'],
    ['上', '下', '左', '右'],
    ['东', '南', '西', '北'],
    ['大', '小'],
    ['高', '低'],
    ['长', '短'],
    ['内', '外'],
    ['男', '女'],
    ['前', '后'],
    ['只', '支', '隻'],
    ['他', '她', '它', '我', '你', '吾', '汝'],
    ['快', '慢'],
    ['春', '夏', '秋', '冬'],
]);
let _zhDictCompareTable_chars = array_hyper_unique_1.array_unique(_zhDictCompareTable.flat());
function zhDictCompare(a, b) {
    let _c = 0;
    let _a0 = a[0];
    let _b0 = b[0];
    let _a;
    let _b;
    let aa = /[\u3400-\u4DBF\u4E00-\u9FFF\u{20000}-\u{2FA1F}]/u.test(a[0]);
    let bb = /[\u3400-\u4DBF\u4E00-\u9FFF\u{20000}-\u{2FA1F}]/u.test(b[0]);
    if (aa && bb) {
        if (a.length != b.length && (a.length == 1 || b.length == 1)) {
            return a.length - b.length;
        }
        _a = _zhDictCompareTable[0].indexOf(a[0]);
        _b = _zhDictCompareTable[0].indexOf(b[0]);
        aa = _a != -1;
        bb = _b != -1;
        if (aa && !bb) {
            return -1;
        }
        else if (!aa && bb) {
            return 1;
        }
    }
    else {
        if (aa && !bb) {
            return 0;
        }
        else if (!aa && bb) {
            return -1;
        }
    }
    if (_a0 != null) {
        let len = a.length;
        for (let i = 0; i < len; i++) {
            if (!a[i] || !b[i] || a[i] == null || b[i] == null) {
                break;
            }
            else if (a[i] !== b[i]) {
                _a0 = a[i];
                _b0 = b[i];
                break;
            }
        }
    }
    if (_zhDictCompareTable_chars.includes(_a0) && _zhDictCompareTable_chars.includes(_b0)) {
        for (let _arr of _zhDictCompareTable) {
            _a = _arr.indexOf(_a0);
            _b = _arr.indexOf(_b0);
            if (_a > -1 && _b > -1) {
                _c = (_a - _b) || 0;
                break;
            }
        }
    }
    return _c || naturalCompare.caseInsensitive(a, b);
}
exports.zhDictCompare = zhDictCompare;
//console.log(['第', '一', 'Ｔ', '网开一面', '三街六市'].sort(zhDictCompare));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBNkM7QUFDN0MscURBQXNEO0FBQ3RELHlDQUFpQztBQUNqQyw0Q0FBNkM7QUFDN0MsNkNBQStFO0FBQy9FLHVEQUFxSDtBQUVySCx5REFBMEQ7QUFDMUQsMkRBQWtEO0FBQ2xELG9DQUFxQztBQVN4QixRQUFBLGNBQWMsR0FBRztJQUM3QixVQUFVO0lBQ1YsU0FBUztJQUNULFVBQVU7SUFDVixTQUFTO0lBQ1QsWUFBWTtJQUNaLFVBQVU7Q0FDVixDQUFDO0FBRUYsU0FBZ0IsUUFBUSxDQUFDLEdBQVcsRUFBRSxPQUFrQixFQUFFLE1BQU0sR0FBRyxzQkFBYztJQUVoRixPQUFPLGVBQWU7U0FDcEIsT0FBTyxDQUFDLG1CQUFRLENBQVMsT0FBTyxFQUFFO1FBQ2xDLEdBQUc7UUFDSCxRQUFRLEVBQUUsSUFBSTtRQUNkLE1BQU07UUFDTixlQUFlLEVBQUUsSUFBSTtLQUNyQixDQUFDLENBQUMsQ0FDRjtBQUNILENBQUM7QUFWRCw0QkFVQztBQVNELFNBQWdCLFlBQVksQ0FBdUIsSUFBWSxFQUM5RCxFQUFtQyxFQUNuQyxPQUVDO0lBR0QsT0FBTyxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7SUFDeEIsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxJQUFJLGlCQUFnQixDQUFDO0lBRXRFLE9BQU8sY0FBSSxDQUFDLElBQUksQ0FBQztTQUNmLElBQUksQ0FBQyxVQUFVLENBQUM7UUFFaEIsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRztZQUU1QyxJQUFJLElBQWEsQ0FBQztZQUVsQixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFekIsSUFBSSxHQUFHLEdBQUc7Z0JBQ1QsSUFBSTtnQkFDSixJQUFJO2dCQUNKLEtBQUs7YUFDTCxDQUFDO1lBRUYsSUFBSSxFQUFFLEVBQ047Z0JBQ0MsYUFBYTtnQkFDYixJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQTthQUNqQjtpQkFFRDtnQkFDQyxJQUFJLEdBQUcsSUFBSSxDQUFDO2FBQ1o7WUFFRCxJQUFJLElBQUksRUFDUjtnQkFDQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ1o7WUFFRCxPQUFPLENBQUMsQ0FBQztRQUNWLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNSLENBQUMsQ0FBQyxDQUNEO0FBQ0gsQ0FBQztBQTVDRCxvQ0E0Q0M7QUFFRCxJQUFZLFlBS1g7QUFMRCxXQUFZLFlBQVk7SUFFdkIsK0NBQVEsQ0FBQTtJQUNSLHFEQUFXLENBQUE7SUFDWCw2REFBZSxDQUFBO0FBQ2hCLENBQUMsRUFMVyxZQUFZLEdBQVosb0JBQVksS0FBWixvQkFBWSxRQUt2QjtBQUVELFNBQWdCLFdBQVcsQ0FBQyxJQUFZO0lBRXZDLElBQUksR0FBRyxHQUFHLFlBQVksQ0FBQyxJQUFJLENBQUM7SUFFNUIsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFDM0I7UUFDQyxHQUFHLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQztRQUUzQixJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQ3hCO1lBQ0MsR0FBRyxHQUFHLFlBQVksQ0FBQyxXQUFXLENBQUM7U0FDL0I7S0FDRDtJQUVELE9BQU8sR0FBRyxDQUFDO0FBQ1osQ0FBQztBQWZELGtDQWVDO0FBRUQsU0FBZ0IsWUFBWSxDQUF3QixFQUFPLEVBQUUsSUFBYztJQUUxRSxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztRQUU1QixhQUFhO1FBQ2IsT0FBTyxjQUFjLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUN4RCxhQUFhO2VBQ1YsY0FBYyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkQsYUFBYTtlQUNWLGNBQWMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZELGFBQWE7ZUFDVixjQUFjLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUN0RDtJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQWRELG9DQWNDO0FBRUQsU0FBZ0IsVUFBVSxDQUFDLENBQVMsRUFBRSxZQUFvQjtJQUV6RCxJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFFZixJQUFJLFlBQVksR0FBRyxDQUFDLEVBQ3BCO1FBQ0MsSUFBSSxRQUFRLEdBQUcsZUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNoQixNQUFNLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ3JCO1NBQ0ksSUFBSSxZQUFZLEVBQ3JCO1FBQ0MsSUFBSSxRQUFRLEdBQUcsZUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDaEIsTUFBTSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNyQjtJQUVELE9BQU8sT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNwQyxDQUFDO0FBbEJELGdDQWtCQztBQUVELElBQUksbUJBQW1CLEdBQUcsQ0FBQyxDQUFDLENBQWEsRUFBRSxDQUFhLEVBQUUsRUFBRTtJQUUzRCxPQUFPLGlDQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUU7UUFFakQsT0FBTyxpQ0FBWSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxFQUFFLFlBQVk7WUFFNUQsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNWLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFFL0IsT0FBTyxDQUFDLENBQUM7UUFDVixDQUFDLEVBQUUsRUFBYyxDQUFDLENBQUMsQ0FBQTtJQUNwQixDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDRixDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztJQUMvRixDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztJQUNwQixDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztJQUNwQixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDVixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDVixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDVixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDVixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDVixDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDVixDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ2YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFB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RyxDQUFDLENBQUMsRUFDdEI7Z0JBQ0MsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFFcEIsTUFBTTthQUNOO1NBQ0Q7S0FDRDtJQUVELE9BQU8sRUFBRSxJQUFJLGNBQWMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ25ELENBQUM7QUFyRkQsc0NBcUZDO0FBRUQsbUVBQW1FIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxpYlRhYmxlIGZyb20gJ2Nqay1jb252L2xpYi96aC90YWJsZSc7XG5pbXBvcnQgeyB0ZXh0TGlzdCB9IGZyb20gJ2Nqay1jb252L2xpYi96aC90YWJsZS9saXN0JztcbmltcG9ydCBGYXN0R2xvYiBmcm9tICdmYXN0LWdsb2InO1xuaW1wb3J0IEJsdWViaXJkUHJvbWlzZSA9IHJlcXVpcmUoJ2JsdWViaXJkJyk7XG5pbXBvcnQgbG9hZCwgeyBwYXJzZUxpbmUsIHN0cmluZ2lmeUxpbmUsIHNlcmlhbGl6ZSB9IGZyb20gJy4uL2xpYi9sb2FkZXIvbGluZSc7XG5pbXBvcnQgeyBJRGljdFJvdywgcGFyc2VMaW5lIGFzIHBhcnNlTGluZVNlZ21lbnQsIHNlcmlhbGl6ZSBhcyBzZXJpYWxpemVTZWdtZW50IH0gZnJvbSAnLi4vbGliL2xvYWRlci9zZWdtZW50L2luZGV4JztcbmltcG9ydCB7IElDVVJfV09SRCB9IGZyb20gJy4uL3Rlc3Qvc29ydCc7XG5pbXBvcnQgbmF0dXJhbENvbXBhcmUgPSByZXF1aXJlKCdzdHJpbmctbmF0dXJhbC1jb21wYXJlJyk7XG5pbXBvcnQgeyBhcnJheV91bmlxdWUgfSBmcm9tICdhcnJheS1oeXBlci11bmlxdWUnO1xuaW1wb3J0IFN0clV0aWwgPSByZXF1aXJlKCdzdHItdXRpbCcpO1xuXG5leHBvcnQgdHlwZSBJTG9hZERpY3RGaWxlUm93MjxEIGV4dGVuZHMgYW55ID0gW3N0cmluZywgbnVtYmVyLCBudW1iZXIsIC4uLmFueVtdXT4gPSBJTG9hZERpY3RGaWxlUm93PEQ+ICYge1xuXHRmaWxlOiBzdHJpbmcsXG5cdGNqa19pZDogc3RyaW5nLFxuXG5cdGxpbmVfdHlwZTogRW51bUxpbmVUeXBlLFxufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9JR05PUkUgPSBbXG5cdC8vJ2NoYXIqJyxcblx0JyoqL3NraXAnLFxuXHQnKiovamllYmEnLFxuXHQnKiovbGF6eScsXG5cdCcqKi9zeW5vbnltJyxcblx0JyoqL25hbWVzJyxcbl07XG5cbmV4cG9ydCBmdW5jdGlvbiBnbG9iRGljdChjd2Q6IHN0cmluZywgcGF0dGVybj86IHN0cmluZ1tdLCBpZ25vcmUgPSBERUZBVUxUX0lHTk9SRSlcbntcblx0cmV0dXJuIEJsdWViaXJkUHJvbWlzZVxuXHRcdC5yZXNvbHZlKEZhc3RHbG9iPHN0cmluZz4ocGF0dGVybiwge1xuXHRcdFx0Y3dkLFxuXHRcdFx0YWJzb2x1dGU6IHRydWUsXG5cdFx0XHRpZ25vcmUsXG5cdFx0XHRtYXJrRGlyZWN0b3JpZXM6IHRydWUsXG5cdFx0fSkpXG5cdFx0O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElMb2FkRGljdEZpbGVSb3c8RCA9IFtzdHJpbmcsIG51bWJlciwgbnVtYmVyLCAuLi5hbnlbXV0+XG57XG5cdGRhdGE6IEQsXG5cdGxpbmU6IHN0cmluZyxcblx0aW5kZXg6IG51bWJlcixcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvYWREaWN0RmlsZTxUID0gSUxvYWREaWN0RmlsZVJvdz4oZmlsZTogc3RyaW5nLFxuXHRmbj86IChsaXN0OiBUW10sIGN1cjogVCkgPT4gYm9vbGVhbixcblx0b3B0aW9ucz86IHtcblx0XHRwYXJzZUZuPzogKGxpbmU6IHN0cmluZykgPT4gYW55LFxuXHR9LFxuKTogQmx1ZWJpcmRQcm9taXNlPFRbXT5cbntcblx0b3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cdGNvbnN0IHBhcnNlRm4gPSBvcHRpb25zLnBhcnNlRm4gPSBvcHRpb25zLnBhcnNlRm4gfHwgcGFyc2VMaW5lU2VnbWVudDtcblxuXHRyZXR1cm4gbG9hZChmaWxlKVxuXHRcdC50aGVuKGZ1bmN0aW9uIChiKVxuXHRcdHtcblx0XHRcdHJldHVybiBiLnJlZHVjZShmdW5jdGlvbiAoYSwgbGluZSwgaW5kZXgsIGFycilcblx0XHRcdHtcblx0XHRcdFx0bGV0IGJvb2w6IGJvb2xlYW47XG5cblx0XHRcdFx0bGV0IGRhdGEgPSBwYXJzZUZuKGxpbmUpO1xuXG5cdFx0XHRcdGxldCBjdXIgPSB7XG5cdFx0XHRcdFx0ZGF0YSxcblx0XHRcdFx0XHRsaW5lLFxuXHRcdFx0XHRcdGluZGV4LFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGlmIChmbilcblx0XHRcdFx0e1xuXHRcdFx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdFx0XHRib29sID0gZm4oYSwgY3VyKVxuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGJvb2wgPSB0cnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGJvb2wpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRhLnB1c2goY3VyKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBhO1xuXHRcdFx0fSwgW10pO1xuXHRcdH0pXG5cdFx0O1xufVxuXG5leHBvcnQgZW51bSBFbnVtTGluZVR5cGVcbntcblx0QkFTRSA9IDAsXG5cdENPTU1FTlQgPSAxLFxuXHRDT01NRU5UX1RBRyA9IDIsXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjaGtMaW5lVHlwZShsaW5lOiBzdHJpbmcpOiBFbnVtTGluZVR5cGVcbntcblx0bGV0IHJldCA9IEVudW1MaW5lVHlwZS5CQVNFO1xuXG5cdGlmIChsaW5lLmluZGV4T2YoJy8vJykgPT0gMClcblx0e1xuXHRcdHJldCA9IEVudW1MaW5lVHlwZS5DT01NRU5UO1xuXG5cdFx0aWYgKC8gQHRvZG8vaS50ZXN0KGxpbmUpKVxuXHRcdHtcblx0XHRcdHJldCA9IEVudW1MaW5lVHlwZS5DT01NRU5UX1RBRztcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYmFzZVNvcnRMaXN0PFQgPSBJTG9hZERpY3RGaWxlUm93Mj4obHM6IFRbXSwgYm9vbD86IGJvb2xlYW4pXG57XG5cdHJldHVybiBscy5zb3J0KGZ1bmN0aW9uIChhLCBiKVxuXHR7XG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHJldHVybiBuYXR1cmFsQ29tcGFyZS5jYXNlSW5zZW5zaXRpdmUoYS5jamtfaWQsIGIuY2prX2lkKVxuXHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0fHwgbmF0dXJhbENvbXBhcmUuY2FzZUluc2Vuc2l0aXZlKGEuZGF0YVsxXSwgYi5kYXRhWzFdKVxuXHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0fHwgbmF0dXJhbENvbXBhcmUuY2FzZUluc2Vuc2l0aXZlKGEuZGF0YVswXSwgYi5kYXRhWzBdKVxuXHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0fHwgbmF0dXJhbENvbXBhcmUuY2FzZUluc2Vuc2l0aXZlKGEuZGF0YVsyXSwgYi5kYXRhWzJdKVxuXHRcdFx0O1xuXHR9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENqa05hbWUodzogc3RyaW5nLCBVU0VfQ0pLX01PREU6IG51bWJlcilcbntcblx0bGV0IGNqa19pZCA9IHc7XG5cblx0aWYgKFVTRV9DSktfTU9ERSA+IDEpXG5cdHtcblx0XHRsZXQgY2prX2xpc3QgPSB0ZXh0TGlzdCh3KTtcblx0XHRjamtfbGlzdC5zb3J0KCk7XG5cdFx0Y2prX2lkID0gY2prX2xpc3RbMF07XG5cdH1cblx0ZWxzZSBpZiAoVVNFX0NKS19NT0RFKVxuXHR7XG5cdFx0bGV0IGNqa19saXN0ID0gbGliVGFibGUuYXV0byh3KTtcblx0XHRjamtfbGlzdC5zb3J0KCk7XG5cdFx0Y2prX2lkID0gY2prX2xpc3RbMF07XG5cdH1cblxuXHRyZXR1cm4gU3RyVXRpbC50b0hhbGZXaWR0aChjamtfaWQpO1xufVxuXG5sZXQgX3poRGljdENvbXBhcmVUYWJsZSA9ICgoYTogc3RyaW5nW11bXSwgYjogc3RyaW5nW11bXSkgPT5cbntcblx0cmV0dXJuIGFycmF5X3VuaXF1ZShhLm1hcCgodmFsdWUsIGluZGV4LCBhcnJheSkgPT5cblx0e1xuXHRcdHJldHVybiBhcnJheV91bmlxdWUodmFsdWUucmVkdWNlKGZ1bmN0aW9uIChjLCBkLCBjdXJyZW50SW5kZXgpXG5cdFx0e1xuXHRcdFx0Yy5wdXNoKGQpO1xuXHRcdFx0Yy5wdXNoKGJbaW5kZXhdW2N1cnJlbnRJbmRleF0pO1xuXG5cdFx0XHRyZXR1cm4gYztcblx0XHR9LCBbXSBhcyBzdHJpbmdbXSkpXG5cdH0pKTtcbn0pKFtcblx0WyfkuIAnLCAn5LqMJywgJ+S4pCcsICfkuIknLCAn5ZubJywgJ+S6lCcsICflha0nLCAn5LiDJywgJ+WFqycsICfkuZ0nLCAn5Y2BJywgJ+WNgScsICfpm7YnLCAn5bm+JywgJ+WAiycsICfnmb4nLCAn5Y2DJywgJ+iQrCcsICflhIQnXSxcblx0WyfkuIonLCAn5LiLJywgJ+W3picsICflj7MnXSxcblx0WyfmnbEnLCAn5Y2XJywgJ+ilvycsICfljJcnXSxcblx0WyflpKcnLCAn5bCPJ10sXG5cdFsn6auYJywgJ+S9jiddLFxuXHRbJ+mVtycsICfnn60nXSxcblx0WyflhacnLCAn5aSWJ10sXG5cdFsn55S3JywgJ+WlsyddLFxuXHRbJ+WJjScsICflvownXSxcblx0Wyflj6onLCAn5pSvJywgJ+mauyddLFxuXHRbJ+S7licsICflpbknLCAn5a6DJywgJ+aIkScsICfkvaAnLCAn5ZC+JywgJ+axnSddLFxuXHRbJ+W/qycsICfmhaInXSxcblx0WyfmmKUnLCAn5aSPJywgJ+eniycsICflhqwnXSxcbl0sIFtcblx0WyfkuIAnLCAn5LqMJywgJ+S4pCcsICfkuIknLCAn5ZubJywgJ+S6lCcsICflha0nLCAn5LiDJywgJ+WFqycsICfkuZ0nLCAn5Y2BJywgJ+WNgScsICfpm7YnLCAn5YegJywgJ+S4qicsICfnmb4nLCAn5Y2DJywgJ+S4hycsICfkur8nXSxcblx0WyfkuIonLCAn5LiLJywgJ+W3picsICflj7MnXSxcblx0WyfkuJwnLCAn5Y2XJywgJ+ilvycsICfljJcnXSxcblx0WyflpKcnLCAn5bCPJ10sXG5cdFsn6auYJywgJ+S9jiddLFxuXHRbJ+mVvycsICfnn60nXSxcblx0WyflhoUnLCAn5aSWJ10sXG5cdFsn55S3JywgJ+WlsyddLFxuXHRbJ+WJjScsICflkI4nXSxcblx0Wyflj6onLCAn5pSvJywgJ+mauyddLFxuXHRbJ+S7licsICflpbknLCAn5a6DJywgJ+aIkScsICfkvaAnLCAn5ZC+JywgJ+axnSddLFxuXHRbJ+W/qycsICfmhaInXSxcblx0WyfmmKUnLCAn5aSPJywgJ+eniycsICflhqwnXSxcbl0pO1xuXG5sZXQgX3poRGljdENvbXBhcmVUYWJsZV9jaGFycyA9IGFycmF5X3VuaXF1ZShfemhEaWN0Q29tcGFyZVRhYmxlLmZsYXQoKSk7XG5cbmV4cG9ydCBmdW5jdGlvbiB6aERpY3RDb21wYXJlKGE6IHN0cmluZywgYjogc3RyaW5nKTogbnVtYmVyXG57XG5cdGxldCBfYyA9IDA7XG5cblx0bGV0IF9hMCA9IGFbMF07XG5cdGxldCBfYjAgPSBiWzBdO1xuXG5cdGxldCBfYTogbnVtYmVyO1xuXHRsZXQgX2I6IG51bWJlcjtcblxuXHRsZXQgYWEgPSAvW1xcdTM0MDAtXFx1NERCRlxcdTRFMDAtXFx1OUZGRlxcdXsyMDAwMH0tXFx1ezJGQTFGfV0vdS50ZXN0KGFbMF0pO1xuXHRsZXQgYmIgPSAvW1xcdTM0MDAtXFx1NERCRlxcdTRFMDAtXFx1OUZGRlxcdXsyMDAwMH0tXFx1ezJGQTFGfV0vdS50ZXN0KGJbMF0pO1xuXG5cdGlmIChhYSAmJiBiYilcblx0e1xuXHRcdGlmIChhLmxlbmd0aCAhPSBiLmxlbmd0aCAmJiAoYS5sZW5ndGggPT0gMSB8fCBiLmxlbmd0aCA9PSAxKSlcblx0XHR7XG5cdFx0XHRyZXR1cm4gYS5sZW5ndGggLSBiLmxlbmd0aFxuXHRcdH1cblxuXG5cdFx0X2EgPSBfemhEaWN0Q29tcGFyZVRhYmxlWzBdLmluZGV4T2YoYVswXSk7XG5cdFx0X2IgPSBfemhEaWN0Q29tcGFyZVRhYmxlWzBdLmluZGV4T2YoYlswXSk7XG5cblx0XHRhYSA9IF9hICE9IC0xO1xuXHRcdGJiID0gX2IgIT0gLTE7XG5cblx0XHRpZiAoYWEgJiYgIWJiKVxuXHRcdHtcblx0XHRcdHJldHVybiAtMVxuXHRcdH1cblx0XHRlbHNlIGlmICghYWEgJiYgYmIpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIDFcblx0XHR9XG5cdH1cblx0ZWxzZVxuXHR7XG5cdFx0aWYgKGFhICYmICFiYilcblx0XHR7XG5cdFx0XHRyZXR1cm4gMFxuXHRcdH1cblx0XHRlbHNlIGlmICghYWEgJiYgYmIpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIC0xXG5cdFx0fVxuXHR9XG5cblx0aWYgKF9hMCAhPSBudWxsKVxuXHR7XG5cdFx0bGV0IGxlbiA9IGEubGVuZ3RoO1xuXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKylcblx0XHR7XG5cdFx0XHRpZiAoIWFbaV0gfHwgIWJbaV0gfHwgYVtpXSA9PSBudWxsIHx8IGJbaV0gPT0gbnVsbClcblx0XHRcdHtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIGlmIChhW2ldICE9PSBiW2ldKVxuXHRcdFx0e1xuXHRcdFx0XHRfYTAgPSBhW2ldO1xuXHRcdFx0XHRfYjAgPSBiW2ldO1xuXG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmIChfemhEaWN0Q29tcGFyZVRhYmxlX2NoYXJzLmluY2x1ZGVzKF9hMCkgJiYgX3poRGljdENvbXBhcmVUYWJsZV9jaGFycy5pbmNsdWRlcyhfYjApKVxuXHR7XG5cdFx0Zm9yIChsZXQgX2FyciBvZiBfemhEaWN0Q29tcGFyZVRhYmxlKVxuXHRcdHtcblx0XHRcdF9hID0gX2Fyci5pbmRleE9mKF9hMCk7XG5cdFx0XHRfYiA9IF9hcnIuaW5kZXhPZihfYjApO1xuXG5cdFx0XHRpZiAoX2EgPiAtMSAmJiBfYiA+IC0xKVxuXHRcdFx0e1xuXHRcdFx0XHRfYyA9IChfYSAtIF9iKSB8fCAwO1xuXG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiBfYyB8fCBuYXR1cmFsQ29tcGFyZS5jYXNlSW5zZW5zaXRpdmUoYSwgYik7XG59XG5cbi8vY29uc29sZS5sb2coWyfnrKwnLCAn5LiAJywgJ++8tCcsICfnvZHlvIDkuIDpnaInLCAn5LiJ6KGX5YWt5biCJ10uc29ydCh6aERpY3RDb21wYXJlKSk7XG4iXX0=