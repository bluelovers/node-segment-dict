"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const table_1 = require("cjk-conv/lib/zh/table");
const list_1 = require("cjk-conv/lib/zh/table/list");
const fast_glob_1 = require("fast-glob");
const BluebirdPromise = require("bluebird");
const line_1 = require("../lib/loader/line");
const index_1 = require("../lib/loader/segment/index");
const naturalCompare = require("string-natural-compare");
const array_hyper_unique_1 = require("array-hyper-unique");
const StrUtil = require("str-util");
exports.DEFAULT_IGNORE = [
    //'char*',
    '**/skip',
    '**/jieba',
    '**/lazy',
    '**/synonym',
    '**/names',
];
function globDict(cwd, pattern, ignore = exports.DEFAULT_IGNORE) {
    return BluebirdPromise
        .resolve(fast_glob_1.default(pattern, {
        cwd,
        absolute: true,
        ignore,
        markDirectories: true,
    }));
}
exports.globDict = globDict;
function loadDictFile(file, fn, options) {
    options = options || {};
    const parseFn = options.parseFn = options.parseFn || index_1.parseLine;
    return line_1.default(file)
        .then(function (b) {
        return b.reduce(function (a, line, index, arr) {
            let bool;
            let data = parseFn(line);
            let cur = {
                data,
                line,
                index,
            };
            if (fn) {
                // @ts-ignore
                bool = fn(a, cur);
            }
            else {
                bool = true;
            }
            if (bool) {
                a.push(cur);
            }
            return a;
        }, []);
    });
}
exports.loadDictFile = loadDictFile;
var EnumLineType;
(function (EnumLineType) {
    EnumLineType[EnumLineType["BASE"] = 0] = "BASE";
    EnumLineType[EnumLineType["COMMENT"] = 1] = "COMMENT";
    EnumLineType[EnumLineType["COMMENT_TAG"] = 2] = "COMMENT_TAG";
})(EnumLineType = exports.EnumLineType || (exports.EnumLineType = {}));
function chkLineType(line) {
    let ret = EnumLineType.BASE;
    if (line.indexOf('//') == 0) {
        ret = EnumLineType.COMMENT;
        if (/ @todo/i.test(line)) {
            ret = EnumLineType.COMMENT_TAG;
        }
    }
    return ret;
}
exports.chkLineType = chkLineType;
function baseSortList(ls, bool) {
    return ls.sort(function (a, b) {
        // @ts-ignore
        return naturalCompare.caseInsensitive(a.cjk_id, b.cjk_id)
            // @ts-ignore
            || naturalCompare.caseInsensitive(a.data[1], b.data[1])
            // @ts-ignore
            || naturalCompare.caseInsensitive(a.data[0], b.data[0])
            // @ts-ignore
            || naturalCompare.caseInsensitive(a.data[2], b.data[2]);
    });
}
exports.baseSortList = baseSortList;
function getCjkName(w, USE_CJK_MODE) {
    let cjk_id = w;
    if (1) {
        cjk_id = list_1.slugify(w, true);
    }
    else if (USE_CJK_MODE > 1) {
        let cjk_list = list_1.textList(w);
        cjk_list.sort();
        cjk_id = cjk_list[0];
    }
    else if (USE_CJK_MODE) {
        let cjk_list = table_1.default.auto(w);
        cjk_list.sort();
        cjk_id = cjk_list[0];
    }
    return StrUtil.toHalfWidth(cjk_id);
}
exports.getCjkName = getCjkName;
let _zhDictCompareTable = ((a, b) => {
    return array_hyper_unique_1.array_unique(a.map((value, index, array) => {
        return array_hyper_unique_1.array_unique(value.reduce(function (c, d, currentIndex) {
            c.push(d);
            c.push(b[index][currentIndex]);
            return c;
        }, []));
    }));
})([
    ['一', '二', '两', '三', '四', '五', '六', '七', '八', '九', '十', '十', '零', '幾', '個', '百', '千', '萬', '億'],
    ['上', '下', '左', '右'],
    ['東', '南', '西', '北'],
    ['大', '小'],
    ['高', '低'],
    ['長', '短'],
    ['內', '外'],
    ['男', '女'],
    ['前', '後'],
    ['只', '支', '隻'],
    ['他', '她', '它', '我', '你', '吾', '汝'],
    ['快', '慢'],
    ['春', '夏', '秋', '冬'],
    ['什', '甚'],
    ['侭', '儘', '尽', '盡'],
    ['的', '得'],
    ['胡', '糊', '鬍'],
    ['壹', '貳', '參', '肆', '伍', '陸', '柒', '捌', '玖', '拾', '什'],
    ['儅', '噹', '当', '當'],
    ['炮', '砲', '炰', '泡'],
], [
    ['一', '二', '两', '三', '四', '五', '六', '七', '八', '九', '十', '十', '零', '几', '个', '百', '千', '万', '亿'],
    ['上', '下', '左', '右'],
    ['东', '南', '西', '北'],
    ['大', '小'],
    ['高', '低'],
    ['长', '短'],
    ['内', '外'],
    ['男', '女'],
    ['前', '后'],
    ['只', '支', '隻'],
    ['他', '她', '它', '我', '你', '吾', '汝'],
    ['快', '慢'],
    ['春', '夏', '秋', '冬'],
    ['什', '甚'],
    ['侭', '儘', '尽', '盡'],
    ['的', '得'],
    ['胡', '糊', '鬍'],
    ['壹', '贰', '参', '肆', '伍', '陆', '柒', '捌', '玖', '拾', '什'],
    ['儅', '噹', '当', '當'],
    ['炮', '砲', '炰', '泡'],
]);
let _zhDictCompareTable_chars = array_hyper_unique_1.array_unique(_zhDictCompareTable.flat());
function zhDictCompare(a, b) {
    let _c = 0;
    let _a0 = a[0];
    let _b0 = b[0];
    let _a;
    let _b;
    let aa = /[\u3400-\u4DBF\u4E00-\u9FFF\u{20000}-\u{2FA1F}]/u.test(a[0]);
    let bb = /[\u3400-\u4DBF\u4E00-\u9FFF\u{20000}-\u{2FA1F}]/u.test(b[0]);
    if (aa && bb) {
        if (a.length != b.length && (a.length == 1 || b.length == 1)) {
            return a.length - b.length;
        }
        _a = _zhDictCompareTable[0].indexOf(a[0]);
        _b = _zhDictCompareTable[0].indexOf(b[0]);
        aa = _a != -1;
        bb = _b != -1;
        if (aa && !bb) {
            return -1;
        }
        else if (!aa && bb) {
            return 1;
        }
    }
    else {
        if (aa && !bb) {
            return 0;
        }
        else if (!aa && bb) {
            return -1;
        }
    }
    if (_a0 != null) {
        let len = a.length;
        for (let i = 0; i < len; i++) {
            if (!a[i] || !b[i] || a[i] == null || b[i] == null) {
                break;
            }
            else if (a[i] !== b[i]) {
                _a0 = a[i];
                _b0 = b[i];
                break;
            }
        }
    }
    if (_zhDictCompareTable_chars.includes(_a0) && _zhDictCompareTable_chars.includes(_b0)) {
        for (let _arr of _zhDictCompareTable) {
            _a = _arr.indexOf(_a0);
            _b = _arr.indexOf(_b0);
            if (_a > -1 && _b > -1) {
                _c = (_a - _b) || 0;
                break;
            }
        }
    }
    return _c || naturalCompare.caseInsensitive(a, b);
}
exports.zhDictCompare = zhDictCompare;
//console.log(['第', '一', 'Ｔ', '网开一面', '三街六市'].sort(zhDictCompare));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBNkM7QUFDN0MscURBQStEO0FBQy9ELHlDQUFpQztBQUNqQyw0Q0FBNkM7QUFDN0MsNkNBQStFO0FBQy9FLHVEQUFxSDtBQUVySCx5REFBMEQ7QUFDMUQsMkRBQWtEO0FBQ2xELG9DQUFxQztBQVN4QixRQUFBLGNBQWMsR0FBRztJQUM3QixVQUFVO0lBQ1YsU0FBUztJQUNULFVBQVU7SUFDVixTQUFTO0lBQ1QsWUFBWTtJQUNaLFVBQVU7Q0FDVixDQUFDO0FBRUYsU0FBZ0IsUUFBUSxDQUFDLEdBQVcsRUFBRSxPQUFrQixFQUFFLE1BQU0sR0FBRyxzQkFBYztJQUVoRixPQUFPLGVBQWU7U0FDcEIsT0FBTyxDQUFDLG1CQUFRLENBQVMsT0FBTyxFQUFFO1FBQ2xDLEdBQUc7UUFDSCxRQUFRLEVBQUUsSUFBSTtRQUNkLE1BQU07UUFDTixlQUFlLEVBQUUsSUFBSTtLQUNyQixDQUFDLENBQUMsQ0FDRjtBQUNILENBQUM7QUFWRCw0QkFVQztBQVNELFNBQWdCLFlBQVksQ0FBdUIsSUFBWSxFQUM5RCxFQUFtQyxFQUNuQyxPQUVDO0lBR0QsT0FBTyxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7SUFDeEIsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxJQUFJLGlCQUFnQixDQUFDO0lBRXRFLE9BQU8sY0FBSSxDQUFDLElBQUksQ0FBQztTQUNmLElBQUksQ0FBQyxVQUFVLENBQUM7UUFFaEIsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRztZQUU1QyxJQUFJLElBQWEsQ0FBQztZQUVsQixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFekIsSUFBSSxHQUFHLEdBQUc7Z0JBQ1QsSUFBSTtn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QUVwQixNQUFNO2FBQ047U0FDRDtLQUNEO0lBRUQsT0FBTyxFQUFFLElBQUksY0FBYyxDQUFDLGVBQWUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQXBGRCxzQ0FvRkM7QUFFRCxtRUFBbUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbGliVGFibGUgZnJvbSAnY2prLWNvbnYvbGliL3poL3RhYmxlJztcbmltcG9ydCB7IHRleHRMaXN0LCBzbHVnaWZ5IH0gZnJvbSAnY2prLWNvbnYvbGliL3poL3RhYmxlL2xpc3QnO1xuaW1wb3J0IEZhc3RHbG9iIGZyb20gJ2Zhc3QtZ2xvYic7XG5pbXBvcnQgQmx1ZWJpcmRQcm9taXNlID0gcmVxdWlyZSgnYmx1ZWJpcmQnKTtcbmltcG9ydCBsb2FkLCB7IHBhcnNlTGluZSwgc3RyaW5naWZ5TGluZSwgc2VyaWFsaXplIH0gZnJvbSAnLi4vbGliL2xvYWRlci9saW5lJztcbmltcG9ydCB7IElEaWN0Um93LCBwYXJzZUxpbmUgYXMgcGFyc2VMaW5lU2VnbWVudCwgc2VyaWFsaXplIGFzIHNlcmlhbGl6ZVNlZ21lbnQgfSBmcm9tICcuLi9saWIvbG9hZGVyL3NlZ21lbnQvaW5kZXgnO1xuaW1wb3J0IHsgSUNVUl9XT1JEIH0gZnJvbSAnLi4vdGVzdC9zb3J0JztcbmltcG9ydCBuYXR1cmFsQ29tcGFyZSA9IHJlcXVpcmUoJ3N0cmluZy1uYXR1cmFsLWNvbXBhcmUnKTtcbmltcG9ydCB7IGFycmF5X3VuaXF1ZSB9IGZyb20gJ2FycmF5LWh5cGVyLXVuaXF1ZSc7XG5pbXBvcnQgU3RyVXRpbCA9IHJlcXVpcmUoJ3N0ci11dGlsJyk7XG5cbmV4cG9ydCB0eXBlIElMb2FkRGljdEZpbGVSb3cyPEQgZXh0ZW5kcyBhbnkgPSBbc3RyaW5nLCBudW1iZXIsIG51bWJlciwgLi4uYW55W11dPiA9IElMb2FkRGljdEZpbGVSb3c8RD4gJiB7XG5cdGZpbGU6IHN0cmluZyxcblx0Y2prX2lkOiBzdHJpbmcsXG5cblx0bGluZV90eXBlOiBFbnVtTGluZVR5cGUsXG59XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX0lHTk9SRSA9IFtcblx0Ly8nY2hhcionLFxuXHQnKiovc2tpcCcsXG5cdCcqKi9qaWViYScsXG5cdCcqKi9sYXp5Jyxcblx0JyoqL3N5bm9ueW0nLFxuXHQnKiovbmFtZXMnLFxuXTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdsb2JEaWN0KGN3ZDogc3RyaW5nLCBwYXR0ZXJuPzogc3RyaW5nW10sIGlnbm9yZSA9IERFRkFVTFRfSUdOT1JFKVxue1xuXHRyZXR1cm4gQmx1ZWJpcmRQcm9taXNlXG5cdFx0LnJlc29sdmUoRmFzdEdsb2I8c3RyaW5nPihwYXR0ZXJuLCB7XG5cdFx0XHRjd2QsXG5cdFx0XHRhYnNvbHV0ZTogdHJ1ZSxcblx0XHRcdGlnbm9yZSxcblx0XHRcdG1hcmtEaXJlY3RvcmllczogdHJ1ZSxcblx0XHR9KSlcblx0XHQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUxvYWREaWN0RmlsZVJvdzxEID0gW3N0cmluZywgbnVtYmVyLCBudW1iZXIsIC4uLmFueVtdXT5cbntcblx0ZGF0YTogRCxcblx0bGluZTogc3RyaW5nLFxuXHRpbmRleDogbnVtYmVyLFxufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9hZERpY3RGaWxlPFQgPSBJTG9hZERpY3RGaWxlUm93PihmaWxlOiBzdHJpbmcsXG5cdGZuPzogKGxpc3Q6IFRbXSwgY3VyOiBUKSA9PiBib29sZWFuLFxuXHRvcHRpb25zPzoge1xuXHRcdHBhcnNlRm4/OiAobGluZTogc3RyaW5nKSA9PiBhbnksXG5cdH0sXG4pOiBCbHVlYmlyZFByb21pc2U8VFtdPlxue1xuXHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblx0Y29uc3QgcGFyc2VGbiA9IG9wdGlvbnMucGFyc2VGbiA9IG9wdGlvbnMucGFyc2VGbiB8fCBwYXJzZUxpbmVTZWdtZW50O1xuXG5cdHJldHVybiBsb2FkKGZpbGUpXG5cdFx0LnRoZW4oZnVuY3Rpb24gKGIpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIGIucmVkdWNlKGZ1bmN0aW9uIChhLCBsaW5lLCBpbmRleCwgYXJyKVxuXHRcdFx0e1xuXHRcdFx0XHRsZXQgYm9vbDogYm9vbGVhbjtcblxuXHRcdFx0XHRsZXQgZGF0YSA9IHBhcnNlRm4obGluZSk7XG5cblx0XHRcdFx0bGV0IGN1ciA9IHtcblx0XHRcdFx0XHRkYXRhLFxuXHRcdFx0XHRcdGxpbmUsXG5cdFx0XHRcdFx0aW5kZXgsXG5cdFx0XHRcdH07XG5cblx0XHRcdFx0aWYgKGZuKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdFx0XHRcdGJvb2wgPSBmbihhLCBjdXIpXG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Ym9vbCA9IHRydWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoYm9vbClcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGEucHVzaChjdXIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIGE7XG5cdFx0XHR9LCBbXSk7XG5cdFx0fSlcblx0XHQ7XG59XG5cbmV4cG9ydCBlbnVtIEVudW1MaW5lVHlwZVxue1xuXHRCQVNFID0gMCxcblx0Q09NTUVOVCA9IDEsXG5cdENPTU1FTlRfVEFHID0gMixcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNoa0xpbmVUeXBlKGxpbmU6IHN0cmluZyk6IEVudW1MaW5lVHlwZVxue1xuXHRsZXQgcmV0ID0gRW51bUxpbmVUeXBlLkJBU0U7XG5cblx0aWYgKGxpbmUuaW5kZXhPZignLy8nKSA9PSAwKVxuXHR7XG5cdFx0cmV0ID0gRW51bUxpbmVUeXBlLkNPTU1FTlQ7XG5cblx0XHRpZiAoLyBAdG9kby9pLnRlc3QobGluZSkpXG5cdFx0e1xuXHRcdFx0cmV0ID0gRW51bUxpbmVUeXBlLkNPTU1FTlRfVEFHO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiByZXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBiYXNlU29ydExpc3Q8VCA9IElMb2FkRGljdEZpbGVSb3cyPihsczogVFtdLCBib29sPzogYm9vbGVhbilcbntcblx0cmV0dXJuIGxzLnNvcnQoZnVuY3Rpb24gKGEsIGIpXG5cdHtcblx0XHQvLyBAdHMtaWdub3JlXG5cdFx0cmV0dXJuIG5hdHVyYWxDb21wYXJlLmNhc2VJbnNlbnNpdGl2ZShhLmNqa19pZCwgYi5jamtfaWQpXG5cdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHR8fCBuYXR1cmFsQ29tcGFyZS5jYXNlSW5zZW5zaXRpdmUoYS5kYXRhWzFdLCBiLmRhdGFbMV0pXG5cdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHR8fCBuYXR1cmFsQ29tcGFyZS5jYXNlSW5zZW5zaXRpdmUoYS5kYXRhWzBdLCBiLmRhdGFbMF0pXG5cdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHR8fCBuYXR1cmFsQ29tcGFyZS5jYXNlSW5zZW5zaXRpdmUoYS5kYXRhWzJdLCBiLmRhdGFbMl0pXG5cdFx0XHQ7XG5cdH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2prTmFtZSh3OiBzdHJpbmcsIFVTRV9DSktfTU9ERTogbnVtYmVyKVxue1xuXHRsZXQgY2prX2lkID0gdztcblxuXHRpZiAoMSlcblx0e1xuXHRcdGNqa19pZCA9IHNsdWdpZnkodywgdHJ1ZSk7XG5cdH1cblx0ZWxzZSBpZiAoVVNFX0NKS19NT0RFID4gMSlcblx0e1xuXHRcdGxldCBjamtfbGlzdCA9IHRleHRMaXN0KHcpO1xuXHRcdGNqa19saXN0LnNvcnQoKTtcblx0XHRjamtfaWQgPSBjamtfbGlzdFswXTtcblx0fVxuXHRlbHNlIGlmIChVU0VfQ0pLX01PREUpXG5cdHtcblx0XHRsZXQgY2prX2xpc3QgPSBsaWJUYWJsZS5hdXRvKHcpO1xuXHRcdGNqa19saXN0LnNvcnQoKTtcblx0XHRjamtfaWQgPSBjamtfbGlzdFswXTtcblx0fVxuXG5cdHJldHVybiBTdHJVdGlsLnRvSGFsZldpZHRoKGNqa19pZCk7XG59XG5cbmxldCBfemhEaWN0Q29tcGFyZVRhYmxlID0gKChhOiBzdHJpbmdbXVtdLCBiOiBzdHJpbmdbXVtdKSA9Plxue1xuXHRyZXR1cm4gYXJyYXlfdW5pcXVlKGEubWFwKCh2YWx1ZSwgaW5kZXgsIGFycmF5KSA9PlxuXHR7XG5cdFx0cmV0dXJuIGFycmF5X3VuaXF1ZSh2YWx1ZS5yZWR1Y2UoZnVuY3Rpb24gKGMsIGQsIGN1cnJlbnRJbmRleClcblx0XHR7XG5cdFx0XHRjLnB1c2goZCk7XG5cdFx0XHRjLnB1c2goYltpbmRleF1bY3VycmVudEluZGV4XSk7XG5cblx0XHRcdHJldHVybiBjO1xuXHRcdH0sIFtdIGFzIHN0cmluZ1tdKSlcblx0fSkpO1xufSkoW1xuXHRbJ+S4gCcsICfkuownLCAn5LikJywgJ+S4iScsICflm5snLCAn5LqUJywgJ+WFrScsICfkuIMnLCAn5YWrJywgJ+S5nScsICfljYEnLCAn5Y2BJywgJ+mbticsICflub4nLCAn5YCLJywgJ+eZvicsICfljYMnLCAn6JCsJywgJ+WEhCddLFxuXHRbJ+S4iicsICfkuIsnLCAn5bemJywgJ+WPsyddLFxuXHRbJ+adsScsICfljZcnLCAn6KW/JywgJ+WMlyddLFxuXHRbJ+WkpycsICflsI8nXSxcblx0Wyfpq5gnLCAn5L2OJ10sXG5cdFsn6ZW3JywgJ+efrSddLFxuXHRbJ+WFpycsICflpJYnXSxcblx0WyfnlLcnLCAn5aWzJ10sXG5cdFsn5YmNJywgJ+W+jCddLFxuXHRbJ+WPqicsICfmlK8nLCAn6Zq7J10sXG5cdFsn5LuWJywgJ+WluScsICflroMnLCAn5oiRJywgJ+S9oCcsICflkL4nLCAn5rGdJ10sXG5cdFsn5b+rJywgJ+aFoiddLFxuXHRbJ+aYpScsICflpI8nLCAn56eLJywgJ+WGrCddLFxuXHRbJ+S7gCcsICfnlJonXSxcblx0Wyfkvq0nLCAn5YSYJywgJ+WwvScsICfnm6EnXSxcblx0WyfnmoQnLCAn5b6XJ10sXG5cdFsn6IOhJywgJ+eziicsICfprI0nXSxcblx0Wyflo7knLCAn6LKzJywgJ+WPgycsICfogoYnLCAn5LyNJywgJ+mZuCcsICfmn5InLCAn5o2MJywgJ+eOlicsICfmi74nLCAn5LuAJ10sXG5cdFsgJ+WEhScsICflmbknLCAn5b2TJywgJ+eVticgXSxcblx0WyAn54KuJywgJ+egsicsICfngrAnLCAn5rOhJyBdLFxuXSwgW1xuXHRbJ+S4gCcsICfkuownLCAn5LikJywgJ+S4iScsICflm5snLCAn5LqUJywgJ+WFrScsICfkuIMnLCAn5YWrJywgJ+S5nScsICfljYEnLCAn5Y2BJywgJ+mbticsICflh6AnLCAn5LiqJywgJ+eZvicsICfljYMnLCAn5LiHJywgJ+S6vyddLFxuXHRbJ+S4iicsICfkuIsnLCAn5bemJywgJ+WPsyddLFxuXHRbJ+S4nCcsICfljZcnLCAn6KW/JywgJ+WMlyddLFxuXHRbJ+WkpycsICflsI8nXSxcblx0Wyfpq5gnLCAn5L2OJ10sXG5cdFsn6ZW/JywgJ+efrSddLFxuXHRbJ+WGhScsICflpJYnXSxcblx0WyfnlLcnLCAn5aWzJ10sXG5cdFsn5YmNJywgJ+WQjiddLFxuXHRbJ+WPqicsICfmlK8nLCAn6Zq7J10sXG5cdFsn5LuWJywgJ+WluScsICflroMnLCAn5oiRJywgJ+S9oCcsICflkL4nLCAn5rGdJ10sXG5cdFsn5b+rJywgJ+aFoiddLFxuXHRbJ+aYpScsICflpI8nLCAn56eLJywgJ+WGrCddLFxuXHRbJ+S7gCcsICfnlJonXSxcblx0Wyfkvq0nLCAn5YSYJywgJ+WwvScsICfnm6EnXSxcblx0WyfnmoQnLCAn5b6XJ10sXG5cdFsn6IOhJywgJ+eziicsICfprI0nXSxcblx0Wyflo7knLCAn6LSwJywgJ+WPgicsICfogoYnLCAn5LyNJywgJ+mZhicsICfmn5InLCAn5o2MJywgJ+eOlicsICfmi74nLCAn5LuAJ10sXG5cdFsgJ+WEhScsICflmbknLCAn5b2TJywgJ+eVticgXSxcblx0WyAn54KuJywgJ+egsicsICfngrAnLCAn5rOhJyBdLFxuXSk7XG5cbmxldCBfemhEaWN0Q29tcGFyZVRhYmxlX2NoYXJzID0gYXJyYXlfdW5pcXVlKF96aERpY3RDb21wYXJlVGFibGUuZmxhdCgpKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHpoRGljdENvbXBhcmUoYTogc3RyaW5nLCBiOiBzdHJpbmcpOiBudW1iZXJcbntcblx0bGV0IF9jID0gMDtcblxuXHRsZXQgX2EwID0gYVswXTtcblx0bGV0IF9iMCA9IGJbMF07XG5cblx0bGV0IF9hOiBudW1iZXI7XG5cdGxldCBfYjogbnVtYmVyO1xuXG5cdGxldCBhYSA9IC9bXFx1MzQwMC1cXHU0REJGXFx1NEUwMC1cXHU5RkZGXFx1ezIwMDAwfS1cXHV7MkZBMUZ9XS91LnRlc3QoYVswXSk7XG5cdGxldCBiYiA9IC9bXFx1MzQwMC1cXHU0REJGXFx1NEUwMC1cXHU5RkZGXFx1ezIwMDAwfS1cXHV7MkZBMUZ9XS91LnRlc3QoYlswXSk7XG5cblx0aWYgKGFhICYmIGJiKVxuXHR7XG5cdFx0aWYgKGEubGVuZ3RoICE9IGIubGVuZ3RoICYmIChhLmxlbmd0aCA9PSAxIHx8IGIubGVuZ3RoID09IDEpKVxuXHRcdHtcblx0XHRcdHJldHVybiBhLmxlbmd0aCAtIGIubGVuZ3RoXG5cdFx0fVxuXG5cdFx0X2EgPSBfemhEaWN0Q29tcGFyZVRhYmxlWzBdLmluZGV4T2YoYVswXSk7XG5cdFx0X2IgPSBfemhEaWN0Q29tcGFyZVRhYmxlWzBdLmluZGV4T2YoYlswXSk7XG5cblx0XHRhYSA9IF9hICE9IC0xO1xuXHRcdGJiID0gX2IgIT0gLTE7XG5cblx0XHRpZiAoYWEgJiYgIWJiKVxuXHRcdHtcblx0XHRcdHJldHVybiAtMVxuXHRcdH1cblx0XHRlbHNlIGlmICghYWEgJiYgYmIpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIDFcblx0XHR9XG5cdH1cblx0ZWxzZVxuXHR7XG5cdFx0aWYgKGFhICYmICFiYilcblx0XHR7XG5cdFx0XHRyZXR1cm4gMFxuXHRcdH1cblx0XHRlbHNlIGlmICghYWEgJiYgYmIpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIC0xXG5cdFx0fVxuXHR9XG5cblx0aWYgKF9hMCAhPSBudWxsKVxuXHR7XG5cdFx0bGV0IGxlbiA9IGEubGVuZ3RoO1xuXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKylcblx0XHR7XG5cdFx0XHRpZiAoIWFbaV0gfHwgIWJbaV0gfHwgYVtpXSA9PSBudWxsIHx8IGJbaV0gPT0gbnVsbClcblx0XHRcdHtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIGlmIChhW2ldICE9PSBiW2ldKVxuXHRcdFx0e1xuXHRcdFx0XHRfYTAgPSBhW2ldO1xuXHRcdFx0XHRfYjAgPSBiW2ldO1xuXG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlmIChfemhEaWN0Q29tcGFyZVRhYmxlX2NoYXJzLmluY2x1ZGVzKF9hMCkgJiYgX3poRGljdENvbXBhcmVUYWJsZV9jaGFycy5pbmNsdWRlcyhfYjApKVxuXHR7XG5cdFx0Zm9yIChsZXQgX2FyciBvZiBfemhEaWN0Q29tcGFyZVRhYmxlKVxuXHRcdHtcblx0XHRcdF9hID0gX2Fyci5pbmRleE9mKF9hMCk7XG5cdFx0XHRfYiA9IF9hcnIuaW5kZXhPZihfYjApO1xuXG5cdFx0XHRpZiAoX2EgPiAtMSAmJiBfYiA+IC0xKVxuXHRcdFx0e1xuXHRcdFx0XHRfYyA9IChfYSAtIF9iKSB8fCAwO1xuXG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiBfYyB8fCBuYXR1cmFsQ29tcGFyZS5jYXNlSW5zZW5zaXRpdmUoYSwgYik7XG59XG5cbi8vY29uc29sZS5sb2coWyfnrKwnLCAn5LiAJywgJ++8tCcsICfnvZHlvIDkuIDpnaInLCAn5LiJ6KGX5YWt5biCJ10uc29ydCh6aERpY3RDb21wYXJlKSk7XG4iXX0=